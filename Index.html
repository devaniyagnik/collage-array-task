<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Table</title>
    <script src="Api.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .form {
        padding: 10px;
      }
      table {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="form">
      <select name="gender" id="gender" multiple>
        <option value="">Select</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <select name="department" id="department" multiple>
        <option value="">Select</option>
        <option value="Computer">Computer</option>
        <option value="Automobile">Automobile</option>
        <option value="Civil">Civil</option>
      </select>
      <select name="year" id="year" multiple>
        <option value="">Select</option>
        <option value="First">First</option>
        <option value="Second">Second</option>
        <option value="Third">Third</option>
        <option value="Fourth">Fourth</option>
        <option value="Pass Out">Pass Out</option>
      </select>

      <br /><br />
      <input
        type="number"
        name="merit"
        id="merit"
        min="0"
        max="99"
        placeholder="merit"
        required
      />
      <select name="conditioninmerit" id="conditioninmerit">
        <option value="">Select</option>
        <option value="lessthan">less than</option>
        <option value="greaterthan">greater than</option>
      </select>

      <br /><br />
      <select name="studenttype" id="studenttype" multiple>
        <option value="">Select</option>
        <option value="merit_12th">Regular</option>
        <option value="merit_diploma">D2D</option>
      </select>

      <button id="submit">Filter</button>
      <button id="duplicate">duplicate</button>
      <button id="sorting">sorting</button>
    </div>
    <table border="1px">
      <thead>
        <th>id</th>
        <th>student_name</th>
        <th>gender</th>
        <th>contact_number</th>
        <th>email_id</th>
        <th>admission_year</th>
        <th>merit_12th</th>
        <th>year</th>
        <th>department</th>
        <th>dep_head</th>
        <th>year_head</th>
      </thead>
      <tbody id="myTablebody"></tbody>
    </table>

    <script>
      const submit = document.getElementById("submit");
      const duplicate = document.getElementById("duplicate");
      const sorting = document.getElementById("sorting");
      const all = document.getElementById("all");

      const meritfilter = document.getElementById("meritfilter");
      const dropdown = document.querySelector(".yeartype");
      const studentfilter = document.getElementById("studentfilter");

      var getallvalue = "All";
      var getgendervalue = [];
      var getyearvalue = [];
      var getdepartmentvalue = [];
      var getmeritvalue = [];
      var getconditioninmerit = [];
      var getstudenttype = [];
      var arrayforphonenumber = [];
      var duplicatebol = false;
      const Tablebody = document.getElementById("myTablebody");
      const clearTable = () => {
        Tablebody.innerHTML = "";
      };
      console.log(data);
      var newarray = [];
      var oldarray = [data.department_data];

      let duplicatesnumber = [];
      var getidof12th = [];
      var alldatasetinstudentid = [];

      const modify_data = () => {
        newarray.splice(0, newarray.length);
        oldarray.splice(0, oldarray.length);
        // duplicatesnumber.splice(0, duplicatesnumber.length);

        const tableRows = data.department_data.forEach((departmentitem) => {
          const dep_head = departmentitem.dep_head;
          const department = departmentitem.department;

          departmentitem.year?.forEach((years) => {
            const yearData = {
              year: years.year,
              year_head: years.year_head,
              student_data: [],
            };
            const year = years.year;
            const year_head = years.year_head;

            years.student_data.forEach((student) => {
              if (duplicatebol) {
                duplicatesnumber = arrayforphonenumber.filter(
                  (number, index, array) => {
                    // Check if the number appears two or more times
                    return array.filter((num) => num === number).length >= 2;
                  }
                );
              }
              // console.log("duplicatesnumber",duplicatesnumber);
              // console.log("arrayforphonenumber",arrayforphonenumber);

              if (
                (getgendervalue.length === 0 || getgendervalue.includes("")
                  ? true
                  : getgendervalue.includes(student.gender)) &&
                (getdepartmentvalue.length === 0 ||
                getdepartmentvalue.includes("")
                  ? true
                  : getdepartmentvalue.includes(department)) &&
                (getyearvalue.length === 0 || getyearvalue.includes("")
                  ? true
                  : getyearvalue.includes(year)) &&
                (getmeritvalue
                  ? getconditioninmerit === "lessthan"
                    ? getmeritvalue > student.merit_12th ||
                      getmeritvalue > student.merit_deploma
                    : true
                  : true) &&
                (getmeritvalue
                  ? getconditioninmerit === "greaterthan"
                    ? getmeritvalue < student.merit_12th ||
                      getmeritvalue < student.merit_deploma
                    : true
                  : true) &&
                (getstudenttype.length === 0 || getstudenttype.includes("")
                  ? true
                  : Object.keys(student).some((e) =>
                      getstudenttype.includes(e)
                    )) &&
                (duplicatebol
                  ? duplicatesnumber.includes(student.contact_number)
                  : true)
              ) {
                /// store value in oldarray
                const meritaddValue = student.hasOwnProperty("merit_12th")
                  ? "merit_12th"
                  : "merit_diploma";
                const studentData = {
                  id: student.id,
                  student_name: student.student_name,
                  gender: student.gender,
                  contact_number: student.contact_number,
                  email_id: student.email_id,
                  admission_year: student.admission_year,
                };
                studentData[meritaddValue] =
                  student.merit_12th || student.merit_diploma;
                yearData.student_data.push(studentData);

                /// store value in newarray
                newarray.push({
                  id: student.id,
                  student_name: student.student_name,
                  contact_number: student.contact_number,
                  email_id: student.email_id,
                  admission_year: student.admission_year,
                  gender: student.gender,
                  merit_12th: student.merit_12th || student.merit_diploma,
                  year: year,
                  year_head: year_head,
                  dep_head: dep_head,
                  department: department,
                });
              }
            });
            if (yearData.student_data.length > 0) {
              const departmentIndex = oldarray.findIndex(
                (item) => item.department === department
              );

              if (departmentIndex === -1) {
                oldarray.push({
                  department: department,
                  dep_head: departmentitem.dep_head,
                  year: [yearData],
                });
              } else {
                oldarray[departmentIndex].year.push(yearData);
              }
            }
          });
        });
      };
      //hi

      const printtable = () => {
        arrayforphonenumber = [];
        newarray.sorting(newarray.contact_number);
        console.log(newarray)
        
        newarray.forEach((student) => {
          

          arrayforphonenumber.push(student.contact_number);
         
          const row = document.createElement("tr");
          const cell5 = document.createElement("td");
          cell5.textContent = student.id;
          const cell6 = document.createElement("td");
          cell6.textContent = student.student_name;
          const cell7 = document.createElement("td");
          cell7.textContent = student.gender;
          const cell8 = document.createElement("td");
          cell8.textContent = student.contact_number;
          const cell9 = document.createElement("td");
          cell9.textContent = student.email_id;
          const cell10 = document.createElement("td");
          cell10.textContent = student.admission_year;
          const cell11 = document.createElement("td");
          cell11.textContent = student.merit_12th || student.merit_diploma;
          const cell1 = document.createElement("td");
          cell1.textContent = student.year;
          const cell2 = document.createElement("td");
          cell2.textContent = student.department;
          const cell3 = document.createElement("td");
          cell3.textContent = student.dep_head;
          const cell4 = document.createElement("td");
          cell4.textContent = student.year_head;

          row.appendChild(cell5);
          row.appendChild(cell6);
          row.appendChild(cell7);
          row.appendChild(cell8);
          row.appendChild(cell9);
          row.appendChild(cell10);
          row.appendChild(cell11);
          row.appendChild(cell1);
          row.appendChild(cell2);
          row.appendChild(cell3);
          row.appendChild(cell4);
          Tablebody.appendChild(row);
        });
      };
      modify_data();
      console.log(oldarray);
      printtable();
      duplicate.addEventListener("click", function () {
        duplicatebol = true;
        clearTable();
        modify_data();

        printtable();
        console.log(newarray);
        console.log(oldarray);
        duplicatebol = false;
      });
      sorting.addEventListener("click", function () {
        duplicatebol = true;
        clearTable();
        modify_data();

        printtable();
        console.log(newarray);
        console.log(oldarray);
        duplicatebol = false;
      });
      submit.addEventListener("click", function () {
        getgendervalue = Array.from(gender.selectedOptions).map(
          (gender) => gender.value
        );
        getdepartmentvalue = Array.from(department.selectedOptions).map(
          (department) => department.value
        );
        getyearvalue = Array.from(year.selectedOptions).map(
          (year) => year.value
        );
        getstudenttype = Array.from(studenttype.selectedOptions).map(
          (studenttype) => studenttype.value
        );
        getmeritvalue = merit.value;
        getconditioninmerit = conditioninmerit.value;

        console.log(getgendervalue);
        clearTable();
        modify_data();

        printtable();
        console.log(newarray);
        console.log(oldarray);
      });
    </script>
  </body>
</html>
